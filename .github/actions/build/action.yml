name: Build Ice

runs:
  using: "composite"
  steps:
    - name: Build C++
      run: |
        export PATH="/usr/lib/ccache:/usr/local/opt/ccache/libexec:$PATH"
        export CONFIGS="shared cpp11-shared"
        make -C cpp -j3 V=1
      shell: bash
      if: runner.os == 'macOS' || runner.os == 'Linux'

    - name: Build join(matrix.languages, ', ')
      run: |
        export PATH="/usr/lib/ccache:/usr/local/opt/ccache/libexec:$PATH"
        export CONFIGS="shared cpp11-shared"
        make -j3 V=1 LANGUAGES="${{ join(matrix.languages, ' ') }}"
      shell: bash
      if: runner.os == 'macOS' || runner.os == 'Linux'

    - name: Build
      run: msbuild /m /p:Platform=x64 ice.proj
      shell: powershell
      if: runner.os == 'Windows'
