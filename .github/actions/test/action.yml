name: Test Ice

inputs:
  language:
    description: "Language to test"
    required: true
    # default: "1"
    # options: ["cpp", "csharp", "java", "python", "js", "swift", "php", "ruby"]

  flags:
    description: "Flags to pass to the test"
    required: false
    default: ""
    # options: ["cpp", "csharp", "java", "python", "js", "swift", "php", "ruby"]

runs:
  using: "composite"
  steps:
    - name: Test
      run: python3 allTests.py --all --workers=4 --export-xml=test-report.xml --languages=${{ inputs.language }} ${{ inputs.flags }}
      shell: bash
      if: startsWith(matrix.os, 'ubuntu') || startsWith(matrix.os, 'macos')

    - name: Test
      run: python allTests.py --all --export-xml=test-report.xml --platform=x64 --workers=4 --languages=${{ inputs.language }} ${{ inputs.flags }}
      shell: powershell
      if: startsWith(matrix.os, 'windows')

    - name: Test Summary
      uses: test-summary/action@v2
      with:
        paths: "test-report.xml"
      if: always()
