# Copyright (c) ZeroC, Inc. All rights reserved.

# Creates a xcframework from a static component and its headers
# $1: The name of the framework (Ice, IceDiscovery, etc.)
# $2: The platform
# $3: Output path

define create-xcframework-from-library

lib/$1.xcframework: $1[macosx-static]
	$(E) Creating lib/$1.xcframework
	$(Q)$(RM) -r $3/$1.xcframework
	$(Q)xcodebuild -create-xcframework -library $(top_srcdir)/cpp/lib/lib$1.a -headers $(top_srcdir)/cpp/include -output lib/$1.xcframework

src all:: lib/$1.xcframework

clean::
	$(E) Cleaning lib/$1.xcframework
	$(Q)$(RM) -r lib/$1.xcframework

endef

xcframeworks	= Ice IceDiscovery IceLocatorDiscovery

$(eval $(call create-xcframework-from-library,Ice,arm64,$(top_srcdir)/cpp/lib))
# $(eval $(call create-xcframework-from-library,IceDiscovery,arm64,$(top_srcdir)/cpp/lib))
# $(eval $(call create-xcframework-from-library,IceLocatorDiscovery,arm64,$(top_srcdir)/cpp/lib))

# $(call make-projects,xcodesdk)

define make-cats-project

cats:
	$(E) "Making cats"

all:: cats

endef
